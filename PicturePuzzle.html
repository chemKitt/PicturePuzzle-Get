<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!--
        DONE
        + load image from best site EVER
        + split image into 4 canvases
        + select the canvas that is clicked on
        + put selected canvas in selected destination

        TO-DO
        + reset, win condition, etc.
        + make preview invisible
        + prettier
        + arrange piece in random order while still knowing the correct placement


    -->
    <meta charset="utf-8">
    <title>Picture Puzzle</title>
    <style>
        body {
            user-select: none;
        }
        #image {
            border: 3px rgb(145, 202, 235);
            border-width: 4px;
            border-radius: 6px;
            border-style: solid;
        }
        #puzzleArea {
            border: 5px dotted #aaaaaa;
        }
        #puzzlePieces {
            border: 5px dashed #4408d1;
            width: 1000px;
        }
    </style>
</head>
    
<body>
    <input type="file" id="input" name="input" onchange="loadFile(event)" accept="image/*"/>
    <br></br>
    <img src="https://thiscatdoesnotexist.com/" id="image" onload="preparePieces()"/>

        <canvas onclick="selectPiece(this)" class="pieces" id=firstPiece></canvas>
        <canvas onclick="selectPiece(this)" class="pieces" id=secondPiece></canvas>
        <canvas onclick="selectPiece(this)" class="pieces" id=thirdPiece></canvas>
        <canvas onclick="selectPiece(this)" class="pieces" id=fourthPiece></canvas>
        <br></br>
        <canvas onclick="placePiece(event,this)" id="puzzleArea">
        
    </canvas>
    
    <script>
        //model
        function $(id) {
            return document.getElementById(id);
        }
        var puzzleArea = $("puzzleArea");
        var image = $("image");
        var piece1 = $("firstPiece");
        var piece2 = $("secondPiece");
        var piece3 = $("thirdPiece");
        var piece4 = $("fourthPiece");
        allPieces = [piece1, piece2, piece3, piece4]

        selected = null;

        //view
        var loadFile = function(event) {
            $("image").src = URL.createObjectURL(event.target.files[0]);
        };

        function preparePieces() {
            puzzleArea.width = image.width;
            puzzleArea.height = image.height;
            pieceCount = 0;
            allPieces.forEach(canvas => {
                pieceCount++;
                context = canvas.getContext("2d");
                canvas.width = image.width/2;
                canvas.height = image.height/2;
                if (pieceCount == 1) {
                    context.drawImage(image, 0, 0, image.width/2, image.height/2, 0, 0, image.width/2, image.height/2);
                }
                else if (pieceCount == 2) {
                    context.drawImage(image, image.width/2, 0, image.width/2, image.height/2, 0, 0, image.width/2, image.height/2);
                }
                else if (pieceCount == 3) {
                    context.drawImage(image, 0, image.width/2, image.width/2, image.height/2, 0, 0, image.width/2, image.height/2);
                }
                else if (pieceCount == 4) {
                    context.drawImage(image, image.width/2, image.width/2, image.width/2, image.height/2, 0, 0, image.width/2, image.height/2);
                }
            });
        }
    
        function selectPiece(piece) {
            selected = piece.id;
            if (selected == piece1.id) {
                console.log("FAR LEFT HAS BEEN SELECTED YES VERY NICE");
                cutX = cutY = 0;
            }
            if (selected == piece2.id) {
                console.log("SECOND PIECE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
                cutX = image.width/2;
                cutY = 0;
            }
            if (selected == piece3.id) {
                console.log("NUMBER THREE");
                cutX = 0;
                cutY = image.height/2;
            }
            if (selected == piece4.id) {
                console.log("the last one.");
                cutX = cutY = image.width/2;
            }
        }

        // function getMousePos(event,canvas) {
        //     var rect = canvas.getBoundingClientRect();
        //     return {
        //         x: event.clientX - rect.left,
        //         y: event.clientY - rect.top
        //     };
        // }

        function placePiece(event,canvas) {
            var x = event.clientX - canvas.offsetLeft;
            var y = event.clientY - canvas.offsetTop;

            if (x < image.width/2 && y < image.height/2) {
                posX = posY = 0;
            }
            else if (x > image.width/2 && y < image.height/2) {
                posX = image.width/2;
                posY = 0;
            }
            else if (x < image.width/2 && y > image.height/2) {
                posX = 0;
                posY = image.height/2;
            }
            else if (x > image.width/2 && y > image.height/2) {
                posX = posY = image.width/2;
            }
            console.log("POSITION IS X:" + x + " AND Y: " + y);
            var context = canvas.getContext("2d");
            context.drawImage(image, cutX, cutY, image.width/2, image.height/2, posX, posY, image.width/2, image.height/2);
        }
        
        // (img,sx,sy,swidth,sheight,x,y,width,height);

        //controller

    </script>
</body>
</html>